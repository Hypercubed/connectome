!function(a){"use strict";var b=window.lrd3||{};b.utils=b.utils||{},b.charts=b.charts||{},b.models=b.models||{},a.lrd3=b}(window),function(a){"use strict";var b=function(){function b(a){a.each(b.draw)}var c,d=_F("name"),e=d3.dispatch("mouseover","mouseout");return b.draw=function(b){function f(a){return"gene.ligand"===a.group?"A":"gene.receptor"===a.group?"V":"circle"}var g=d3.select(this),h=g.selectAll(".label").data(b).enter().append("g").attr("class","label").on("mouseover",function(a){h.style("opacity",function(b){return b===a?1:.2}),e.mouseover.apply(this,arguments)}).on("mouseout",function(){h.style("opacity",1),e.mouseout.apply(this,arguments)}).attr("transform",function(a,b){return"translate(0,"+20*(b+1)+")"}),i=a.models.hiveSymbol().type(f).size(120);h.append("path").style({"stroke-width":"1px",stroke:"rgb(51, 51, 51)"}).attr("d",i).style("fill",c),h.append("text").style({stroke:"none",fill:"#333","stroke-width":"1px","font-size":"10px"}).attr("x",20).attr("dy","0.4em").text(d)},b.colors=function(a){return arguments.length<1?c:(c=a,b)},d3.rebind(b,e,"on")};a.models.legend=b}(window.lrd3),function(a){"use strict";var b=function(){function b(a){a.each(b.draw)}var c,d,e=500,f=500,g={top:10,right:60,bottom:240,left:60},h=d3.behavior.zoom(),i=["gene.ligand","gene.receptor","sample"],j=d3.scale.ordinal().domain(["ligand","both","receptor"]).range(["#ed1940","yellow","#3349ff"]),k=d3.scale.log().range([2,9]).clamp(!0),l=d3.scale.linear().range([.2,.8]).clamp(!0),m=d3.scale.linear().range([3,12]).clamp(!0),n=d3.scale.linear(),o={};i.forEach(function(a){o[a]=d3.scale.ordinal().rangePoints([0,1])});var p=_F("group"),q=_F("value"),r=_F("id"),s=_F("class"),t=_F("fixed"),u=_F("hover"),v=function(a){return[a.source.name,a.name,a.target.name].join(":")},w=function(a){return a.name.split(".")[0]},x=_F("class",j),y=_F(q,k),z=d3.dispatch("hover","selectionChanged");return b.draw=function(i){function j(){d.attr("d",function(a){var b=a.source.x,c=a.source.y,d=a.target.x,g=a.target.y,h=d-b,i=g-c,j=Math.sqrt(h*h+i*i),k=j,l=j,n=0,o=0,p=1;if(b===b&&c===g){o=1,p=0;var q=b-e/2,r=c-f/2,s=Math.sqrt(q*q+r*r);n=180*Math.atan(r/q||0)/Math.PI,k=30,l=20,d+=r/s,g-=q/s}else{var t=m(a.target.value)+y(a)+5,u=Math.PI/6,v=Math.cos(u),w=Math.sin(u);d-=t*(h/j*v-i/j*w),g-=t*(h/j*w+i/j*v)}return"M"+b+","+c+"A"+k+","+l+" "+n+","+o+","+p+" "+d+","+g}),c.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}function o(){var a=d3.event.translate,b=d3.event.scale;S.attr("transform","translate("+a+") scale("+b+")")}function A(a,b,c,d){arguments.length<4&&(d=!0);var e=0>=b?"source":"target",f=0>=b?i._inEdgesIndex[a.id]:i._outEdgesIndex[a.id];f.forEach(function(a){if(a){a[c]=d;var f=a[e];f[c]=d,"gene"===f.type&&A(f,b,c,d)}})}function B(a){var c=a.target,d=a.source;a.hover=c.hover=d.hover=!0,"node"!==c.type&&A(c,3,"hover"),"node"!==d.type&&A(d,-3,"hover"),b.container.classed("hover",!0),D(),z.hover(a)}function C(a){a.hover=!0,A(a,3,"hover"),A(a,-3,"hover"),b.container.classed("hover",!0),D(),z.hover(a)}function D(){c.classed("hover",u).classed("fixed",t),d.classed("hover",u).classed("fixed",t)}function E(){b.container.classed("hover",!1),c.each(T),d.each(T),D(),z.hover(null)}function F(a){if(!d3.event.defaultPrevented){d3.event.stopPropagation();var b=a.fixed;d3.event.altKey?a.ticked=b?!1:!0:d3.event.ctrlKey&&!d3.event.shiftKey?a.fixed=b?!1:!0:d3.event.shiftKey?i.nodes.forEach(function(a){a.fixed=a.hover?!b:d3.event.ctrlKey?a.fixed:!1}):(i.nodes.forEach(function(a){a.fixed=!1}),a.fixed=b?!1:!0),D(),z.selectionChanged(a)}}function G(a){if(!d3.event.defaultPrevented){d3.event.stopPropagation();var b=a.fixed;d3.event.altKey?a.ticked=a.ticked?!1:!0:d3.event.ctrlKey&&!d3.event.shiftKey?a.fixed=a.fixed?!1:!0:d3.event.shiftKey?i.nodes.forEach(function(a){a.fixed=a.hover?!b:d3.event.ctrlKey?a.fixed:!1}):(i.nodes.forEach(function(a){a.fixed=!1}),a.fixed=b?!1:!0),D(),z.selectionChanged(a)}}function H(a){return"gene"===a.type?5:m(a.value)}function I(a){return-H(a)}function J(a){return 2*H(a)}function K(a){return"gene"===a.type?0:H(a)}function L(a){if(null===a)return M.classed("hover",!1),void c.classed("hover",!1);var b=p.eq(a.group).and(s.eq(a.class));c.classed("hover",b),M.classed("hover",!0)}var M=d3.select(this);e=parseInt(M.style("width")),f=parseInt(M.style("height"));var N=Math.min(f,e)/(1+Math.cos(Math.PI/3))/1.5;n.range([N/10,N]),b.update=function(){D()},b.container=M,M.attr("width",e).attr("height",f),M.on("click",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),i.nodes.forEach(function(a){a.fixed=!1}),D(),z.selectionChanged())});var O=d3.extent(i._edges,q);k.domain(O),l.domain(O);var P=d3.extent(i._nodes,q);m.domain(P);var Q=d3.layout.force().charge(-2e3).linkDistance(function(a){return"pair"===a.type?1:400}).size([e,f]).on("tick",j);i._nodes.forEach(function(a){delete a.x,delete a.y}),Q.nodes(i._nodes).links(i._edges).start();var R=Q.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()});M.selectAll("defs").remove(),M.append("defs").append("svg:marker").attr("class","Triangle").attr("viewBox","0 -5 10 10").attr("refY",0).attr("refX",2.5).attr("markerWidth",2.5).attr("markerHeight",2.5).attr("stroke-width",1).attr("markerUnits","strokeWidth").attr("orient","auto").attr("id","arrow").append("svg:path").attr("d","M0,-5L10,0L0,5");var S=M.selectAll(".networkGraph").data([1]);S.enter().append("g").attr("class","networkGraph").each(function(){M.call(h.on("zoom",o)),h.translate([0,g.top]),h.event(M)});var T=function(a){a.hover=!1},U=S.selectAll("g.links").data([i._edges]);U.enter().append("g").classed("links",!0),d=U.selectAll(".link").data(_F(),v),d.enter().append("path").classed("link",!0).style({fill:"none",stroke:"#666","stroke-width":"1.5px"}).style("opacity",function(a){return l(a.value)}).on("mouseover.highlight",B).on("mouseout.highlight",E).on("click",F).attr("marker-end",function(a){return a.source!==a.target?'url("#arrow")':""}),d.style("stroke-width",y),d.exit().remove();var V=S.selectAll("g.nodes").data([i._nodes]);V.enter().append("g").classed("nodes",!0),c=V.selectAll(".node").data(_F(),r);var W=c.enter().append("g").classed("node",!0).style({fill:"#ccc","fill-opacity":1,stroke:"#333","stroke-width":"1px"}).on("click",G).on("dblclick",function(a){d3.event.stopPropagation();var b=d3.event.shiftKey?i.inEdgesIndex[a.id]:i.outEdgesIndex[a.id];if(d3.event.altKey){for(var c=b.length;c>-1;c--)if("sample-sample"===b[c].type){var d=d3.event.shiftKey?b[c].source:b[c].target;if(d.ticked){d.ticked=!1;break}}}else for(var e=0;e<b.length;e++)if("sample-sample"===b[e].type){var f=d3.event.shiftKey?b[e].source:b[e].target;if(!f.ticked){f.ticked=!0;break}}D(),z.selectionChanged(a)}).on("mouseover.highlight",C).on("mouseout.highlight",E).call(R);W.append("rect"),W.append("text").style({stroke:"none",fill:"#333","stroke-width":"1px","font-size":"10px"}).attr("text-anchor","start").attr("dy",3).attr("dx",15),c.attr("id",function(a){return"node-"+a._index}).classed("fixed",t),c.select("rect").attr("x",I).attr("y",I).attr("width",J).attr("height",J).attr("rx",K).attr("ry",K).style("fill",x),c.select("text").text(w).attr("dy",function(a){return"gene"===a.type?0:3}).attr("dx",function(a){return"gene"===a.type?10:15}),c.exit().remove();var X=[{name:"Ligand expressing cell","class":"ligand",group:"sample"},{name:"Receptor expressing cell","class":"receptor",group:"sample"},{name:"Ligand and receptor expressing cell","class":"both",group:"sample"}],Y=a.models.legend().colors(x).on("mouseover",_F(null,L)).on("mouseout",function(){L(null)});M.selectAll(".caxis").remove(),M.append("g").attr("class","axis caxis").attr("transform","translate("+g.left+","+g.top+")").datum(X).call(Y)},d3.rebind(b,z,"on"),b};a.charts.forceGraph=b}(window.lrd3),function(a){"use strict";function b(a){return a/Math.PI*180-90}var c=function(){function a(a){var b=Math.sqrt(a/3.14159);return"M0,"+b+"A"+b+","+b+" 0 1,1 0,"+-b+"A"+b+","+b+" 0 1,1 0,"+b+"Z"}function b(a){var b=Math.sqrt(a)/2;return"M"+-b+","+-b+"L"+b+","+-b+" "+b+","+b+" "+-b+","+b+"Z"}function c(a){var b=Math.sqrt(a)/2;return"M"+-b+","+-b+"L0,0 "+b+","+-b+" "+b+","+b+" "+-b+","+b+"Z"}function d(a){var b=Math.sqrt(a)/2;return"M"+-b+","+-b+"L"+b+","+-b+" "+b+",0 0,"+b+" "+-b+",0Z"}function e(b,c){return(h.get(f.call(this,b,c))||a)(g.call(this,b,c))}var f=d3.functor("circle"),g=64,h=d3.map({circle:a,square:b,A:d,V:c});return e.type=function(a){return arguments.length?(f=d3.functor(a),e):f},e.size=function(a){return arguments.length?(g=d3.functor(a),e):g},e},d=function(){function d(a){a.each(d.draw)}var e,f,g=500,h=500,i={top:10,right:60,bottom:240,left:60},j=d3.behavior.zoom(),k=["gene.ligand","gene.receptor","sample"],l=d3.scale.ordinal().domain(["ligand","both","receptor"]).range(["#ed1940","yellow","#3349ff"]),m=d3.scale.log().range([2,9]).clamp(!0),n=d3.scale.linear().range([.2,.8]).clamp(!0),o=d3.scale.linear().range([3,12]).clamp(!0),p=d3.scale.ordinal().domain(k).range([-Math.PI/4+Math.PI,Math.PI/4+Math.PI,0]),q=d3.scale.linear(),r={};k.forEach(function(a){r[a]=d3.scale.ordinal().rangePoints([0,1])});var s=_F("group"),t=_F("value"),u=_F("id"),v=_F("class"),w=_F("fixed"),x=_F("source",w).and(_F("target",w)),y=_F("hover"),z=function(a){return[a.source.name,a.name,a.target.name].join(":")},A=function(a){return a.name.split(".")[0]},B=_F("group",p),C=function(a){return r[s(a)]?q(r[s(a)](a._i)):0},D=_F("class",l),E=_F(t,m),F=d3.dispatch("hover","selectionChanged","contextmenu");return d.draw=function(l){function G(a){var b=-B(a)+Math.PI;return b=(b+2*Math.PI)%(2*Math.PI),b>Math.PI/2&&b<3*Math.PI/2?b:b+Math.PI/2}function H(){var a=d3.event.translate,b=d3.event.scale;X.attr("transform","translate("+a+") scale("+b+")")}function I(a,b,c,d){arguments.length<4&&(d=!0);var e=0>=b?"source":"target",f=0>=b?l._inEdgesIndex[a.id]:l._outEdgesIndex[a.id];f.forEach(function(a){if(a){a[c]=d;var f=a[e];f[c]=d,"gene"===f.type&&I(f,b,c,d)}})}function J(a){var b=a.target,c=a.source;a.hover=b.hover=c.hover=!0,"gene"===b.type&&I(b,3,"hover"),"gene"===c.type&&I(c,-3,"hover"),d.container.classed("hover",!0),L(),F.hover(a)}function K(a){a.hover=!0,I(a,3,"hover"),I(a,-3,"hover"),d.container.classed("hover",!0),L(),F.hover(a)}function L(){e.classed("hover",y).classed("fixed",w),f.classed("hover",y).classed("fixed",x)}function M(){d.container.classed("hover",!1),e.each(Z),f.each(Z),L(),F.hover(null)}function N(a){d3.event.stopPropagation();var b=a.fixed;d3.event.altKey?a.ticked=a.ticked?!1:!0:d3.event.ctrlKey&&!d3.event.shiftKey?a.fixed=a.fixed?!1:!0:d3.event.shiftKey?l.nodes.forEach(function(a){a.fixed=a.hover?!b:d3.event.ctrlKey?a.fixed:!1}):(l.nodes.forEach(function(a){a.fixed=!1}),a.fixed=b?!1:!0),L(),F.selectionChanged(a)}function O(a){return"gene.ligand"===a.group?"A":"gene.receptor"===a.group?"V":"circle"}function P(a){return"gene"===a.type?90:15*o(a.value)}function Q(a){if(null===a)return R.classed("hover",!1),void e.style("opacity",1).classed("hover",!1);var b=s.eq(a.group).and(v.eq(a.class));e.classed("hover",b),R.classed("hover",!0)}var R=d3.select(this);g=parseInt(R.style("width")),h=parseInt(R.style("height"));var S=Math.min(h,g)/(1+Math.cos(Math.PI/3))/1.5;q.range([S/10,S]),d.update=function(){L()},d.container=R,R.attr("width",g).attr("height",h);var T=d3.extent(l._edges,t);m.domain(T),n.domain(T);var U=d3.extent(l._nodes,t);o.domain(U);var V=d3.nest().key(s).sortKeys(d3.ascending).entries(l._nodes);V.forEach(function(a){r[a.key]&&(r[a.key].domain(d3.range(a.values.length)),a.values.forEach(function(a,b){a._i=b}))});var W=d3.hive.link().angle(B).radius(C);R.selectAll("defs").remove();var X=R.selectAll(".hiveGraph").data([1]);X.enter().append("g").attr("class","hiveGraph").each(function(){R.call(j.on("zoom",H)),j.translate([g/2,h/2+(h/2-S)]),j.event(R)}),R.on("click",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),l.nodes.forEach(function(a){a.fixed=!1}),L(),F.selectionChanged())});var Y=X.selectAll(".axis").data(k);Y.enter().append("line").style({stroke:"#000","stroke-width":"1.5px"}),Y.attr({"class":"axis",transform:function(a){return"rotate("+b(p(a))+")"},x1:q.range()[0],x2:q.range()[1]});var Z=function(a){a.hover=!1},$=X.selectAll("g.links").data([l._edges]);$.enter().append("g").classed("links",!0),f=$.selectAll(".link").data(_F(),z),f.enter().append("svg:path").classed("link",!0).style({fill:"none",stroke:"#666","stroke-width":"1.5px"}).on("mouseover.highlight",J).on("mouseout.highlight",M),f.attr({id:function(a){return"link-"+a._index},d:W}).style({"stroke-width":E,opacity:function(a){return n(a.value)}}),f.exit().remove();var _=X.selectAll("g.nodes").data([l._nodes]);_.enter().append("g").classed("nodes",!0),_.selectAll(".node").remove(),e=_.selectAll(".node").data(_F(),u);var ab=e.enter().append("g").classed("node",!0).style({fill:"#ccc","fill-opacity":1,stroke:"#333","stroke-width":"1px"}).on("click",N).on("dblclick",function(a){d3.event.stopPropagation();for(var b=l.outEdgesIndex[a.id],c=0;c<b.length;c++)if(!b[c].target.ticked){b[c].target.ticked=!0;break}L(),F.selectionChanged(a)}).on("contextmenu",function(a){d3.event.preventDefault(),F.contextmenu(a)}).on("mouseover.highlight",K).on("mouseout.highlight",M),bb=c().type(O).size(P);ab.append("path").attr("d",bb),ab.append("text").style({stroke:"none",fill:"#333","stroke-width":"1px","font-size":"10px"}).attr({"text-anchor":"start",dy:3,dx:15}).attr("transform",function(a){return"rotate( "+b(G(a))+" )"}),e.attr("id",function(a){return"node-"+a._index}).classed("fixed",w).attr("transform",function(a){return"rotate( "+b(B(a))+" ) translate("+C(a)+")"}),e.each(function(a){var b=this.getBoundingClientRect();a.x=b.left,a.y=b.top}),e.select("path").style("fill",D),e.select("text").text(A).attr({dy:function(a){return"gene"===a.type?0:3},dx:function(a){return"gene"===a.type?10:15}}),e.exit().remove();var cb=a.models.legend().colors(D).on("mouseover",_F(null,Q)).on("mouseout",function(){Q(null)}),db=[{name:"Ligand expressing cell","class":"ligand",group:"sample"},{name:"Receptor expressing cell","class":"receptor",group:"sample"},{name:"Ligand and receptor expressing cell","class":"both",group:"sample"},{name:"Ligand gene","class":"ligand",group:"gene.ligand"},{name:"Receptor gene","class":"receptor",group:"gene.receptor"}];R.selectAll(".caxis").remove(),R.append("g").attr({"class":"axis caxis",transform:"translate("+i.left+","+i.top+")"}).datum(db).call(cb)},d3.rebind(d,F,"on"),d};a.charts.hiveGraph=d,a.models.hiveSymbol=c}(window.lrd3);